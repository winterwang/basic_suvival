<!DOCTYPE html>
<html>
  <head>
    <title>Survival Analysis</title>
    <meta charset="utf-8">
    <meta name="author" content="Chaochen Wang" />
    <link href="libs/remark-css/default.css" rel="stylesheet" />
    <link href="libs/remark-css/metropolis-fonts.css" rel="stylesheet" />
    <link rel="stylesheet" href="css/LSHTM.css" type="text/css" />
  </head>
  <body>
    <textarea id="source">
class: center, middle, inverse, title-slide

# Survival Analysis
## The basic ideas
### Chaochen Wang
### 2018/10/03 (updated: 2018-09-25)

---




# Describing survival data (1)

&lt;!-- ### Important assumptions:  --&gt;

&lt;!-- + It is assumed that censoring is uninformative about event times. --&gt;

&lt;!-- + This means that the time at which an individual is censored, or the fact that they are censored, does not give us any information about when that person may have the event. --&gt;

+ We define a random variable `\(T\)`, which represents survival time.

+ The survival function 

    + The survivor function at a time `\(t\)` is the probability that the survival time `\(T\)` exceeds a value `\(t\)`:

`$$S(t) = \text{Pr}(T&gt;t)$$`
  + Relation to the cumulative distribution function: 
    
$$
`\begin{aligned}
F(t) &amp; =  \text{Pr}(T\leqslant t) \\
     &amp; = 1 - \text{Pr}(T&gt;t) \\ 
     &amp; = 1- S(t)
\end{aligned}`
$$

+ the hazard function

$$
h(t) = \text{lim}_{\delta\rightarrow0}\frac{1}{\delta}\text{Pr}(t\leqslant T &lt; t + \delta | T \geqslant t)
$$


---
class: middle

# Describing survival data (2)

- the cumulative hazard function

$$
H(t) = \int_o^th(u)du
$$


- the probability density function at time `\(t\)`:

$$
f(t) = \frac{d}{dt}F(t) = \text{lim}_{\delta\rightarrow0}\frac{1}{\delta}\text{Pr}(t\leqslant T &lt; t + \delta)
$$
- In general, and in particular to incorporate continuous variables and adjustment for confounders, we want to use
**regression-based approaches** to analysing survival data. 

- Methods of analysis need to **handle censoring** and need to allow for the fact that **survival times are strictly non-negative**.


---
class: middle

### Relationships between functions (1)

&lt;!-- ## `\(S(t), h(t), H(t), f(t)\)` --&gt;

$$
`\begin{aligned}
f(t) &amp; = \frac{\text{d}}{\text{d}t}F(t)  = \frac{\text{d}}{\text{d}t}\{ 1-S(t) \} = - \frac{\text{d}}{\text{d}t}S(t) \\
S(t) &amp; = 1 - F(t)  = 1 - \int_0^t f(u)\text{d}u = \int_t^\infty f(u)\text{d}u \\
h(t) &amp; = \lim_{\delta\rightarrow0}\frac{1}{\delta}\text{Pr}(t \leqslant T &lt; t+ \delta | T &gt; t) \\
     &amp; = \lim_{\delta\rightarrow0}\frac{1}{\delta}\frac{\text{Pr}(t \leqslant T &lt; t+ \delta, T &gt; t)}{\text{Pr}(T &gt; t)} (\text{Bayes' Theroem}) \\
     &amp; = \lim_{\delta\rightarrow0}\frac{1}{\delta}\frac{\text{Pr}(t \leqslant T &lt; t+ \delta)}{\text{Pr}(T &gt; t)} = \frac{f(t)}{S(t)}\\
h(t) &amp; = \frac{f(t)}{S(t)} = \frac{\frac{\text{d}}{\text{d}t}F(t)}{S(t)}  \\
     &amp; = \frac{- \frac{\text{d}}{\text{d}t}S(t)}{S(t)} = -\frac{d\log[S(t)]}{dS(t)}\cdot\frac{dS(t)}{dt}  \\ 
     &amp; = - \frac{\text{d}}{\text{d}t}\text{log}[S(t)] (\text{chain rule}) \\
\end{aligned}`
$$


---
class: middle

### Relationships between functions (2)

$$
`\begin{aligned}
H(t) &amp;  = \int_0^th(u)du = \int_0^t\frac{f(u)}{S(u)}du = \int_0^t\frac{f(u)}{1-F(u)}du  \\
     &amp; = - \int_0^t\frac{-f(u)}{1-F(u)}du = - \log[1-F(t)] = -\log[S(t)] \\ 
\Rightarrow S(t) &amp; = \exp(-H(t))
\end{aligned}`
$$


---
class: middle
# Analysing survival data

### 1. Fully parametric methods
- Exponential distribution
- Weibull distribution
- Log-logistic distribution

### 2. Non-parametric methods

- Kaplan-Meier estimate of the survivor function
- Life table estimates
- Log rank test
- Nelson-Aalen estimate of the cumulative hazard

### 3. Semi-parametric methods

- Cox proportional hazards model

---
class: middle

### Exponential distribution

Under the exponential distribution the hazard rate is constant over time: `\(\lambda\)`

$$
`\begin{aligned}
h(t) &amp; = \lambda \\
S(t) &amp; = \exp(-\lambda t) \\
f(t) &amp; = \lambda\exp(-\lambda t)
\end{aligned}`
$$


### Weibull Distribution 

$$
`\begin{aligned}
h(t) 
\end{aligned}`
$$
    </textarea>
<script src="https://remarkjs.com/downloads/remark-latest.min.js"></script>
<script>var slideshow = remark.create({
"highlightStyle": "github",
"highlightLines": true,
"countIncrementalSlides": false
});
if (window.HTMLWidgets) slideshow.on('afterShowSlide', function (slide) {
  window.dispatchEvent(new Event('resize'));
});
(function() {
  var d = document, s = d.createElement("style"), r = d.querySelector(".remark-slide-scaler");
  if (!r) return;
  s.type = "text/css"; s.innerHTML = "@page {size: " + r.style.width + " " + r.style.height +"; }";
  d.head.appendChild(s);
})();
(function(time) {
  var d2 = function(number) {
    return ('0' + number).slice(-2); // left-pad 0 to minutes/seconds
  },

  time_format = function(total) {
    var secs = Math.abs(total) / 1000;
    var h = Math.floor(secs / 3600);
    var m = Math.floor(secs % 3600 / 60);
    var s = Math.round(secs % 60);
    var res = d2(m) + ':' + d2(s);
    if (h > 0) res = h + ':' + res;
    return res;  // [hh:]mm:ss
  },

  slide_number_div = function(i) {
    return document.getElementsByClassName('remark-slide-number').item(i);
  },

  current_page_number = function(i) {
    return slide_number_div(i).firstChild.textContent;  // text "i / N"
  };

  var timer = document.createElement('span'); timer.id = 'slide-time-left';
  var time_left = time, k = slideshow.getCurrentSlideIndex(),
      last_page_number = current_page_number(k);

  setInterval(function() {
    time_left = time_left - 1000;
    timer.innerHTML = ' ' + time_format(time_left);
    if (time_left < 0) timer.style.color = 'red';
  }, 1000);

  slide_number_div(k).appendChild(timer);

  slideshow.on('showSlide', function(slide) {
    var i = slide.getSlideIndex(), n = current_page_number(i);
    // reset timer when a new slide is shown and the page number is changed
    if (last_page_number !== n) {
      time_left = time; last_page_number = n;
      timer.innerHTML = ' ' + time_format(time); timer.style.color = null;
    }
    slide_number_div(i).appendChild(timer);
  });
})(60000);</script>

<script>
(function() {
  var i, text, code, codes = document.getElementsByTagName('code');
  for (i = 0; i < codes.length;) {
    code = codes[i];
    if (code.parentNode.tagName !== 'PRE' && code.childElementCount === 0) {
      text = code.textContent;
      if (/^\\\((.|\s)+\\\)$/.test(text) || /^\\\[(.|\s)+\\\]$/.test(text) ||
          /^\$\$(.|\s)+\$\$$/.test(text) ||
          /^\\begin\{([^}]+)\}(.|\s)+\\end\{[^}]+\}$/.test(text)) {
        code.outerHTML = code.innerHTML;  // remove <code></code>
        continue;
      }
    }
    i++;
  }
})();
</script>
<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
(function () {
  var script = document.createElement('script');
  script.type = 'text/javascript';
  script.src  = 'https://cdn.bootcss.com/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML';
  if (location.protocol !== 'file:' && /^https?:/.test(script.src))
    script.src  = script.src.replace(/^https?:/, '');
  document.getElementsByTagName('head')[0].appendChild(script);
})();
</script>
  </body>
</html>
